<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="/milligram.min.css" />
  <style>
      :root {
        --mg-color-primary: #800080;
        --mg-control-radius: 1.5rem;
        --mg-input-radius: 1rem;
      }
      body {background: #ffeeff;}
  </style>
</head>

<body>
  <main class="wrapper">
    <section class="mg-container" id="header">
      <div class="mg-row">
        <div class="mg-col mg-x3">
          <?xml version="1.0" encoding="UTF-8"?>
          <svg width="140px" height="140px" version="1.0" viewBox="0 0 877 767" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(0 767) scale(.1 -.1)">
              <path
                d="m7745 7659c-200-24-381-105-516-231-247-230-381-587-340-903 22-164 62-315 128-480 32-78 201-421 223-450 31-42 316-611 364-727 98-237 157-457 176-659 23-245-22-526-117-719-39-79-61-110-133-183-73-72-102-94-173-127-47-22-87-40-90-40-2 0 4 25 14 55 129 390 118 990-27 1529-183 677-533 1219-1049 1619-323 251-743 447-1150 537-55 12-162 32-238 44l-139 22-17 52c-45 133-147 226-271 247-185 32-821-293-1199-612-35-30-69-52-76-49-7 2-60 10-117 17-182 21-451-2-611-53l-67-22-153 155c-291 296-523 458-772 541-96 31-201 31-273-1-95-43-142-118-217-349-57-174-69-252-62-404 6-134 25-217 76-340 64-153 217-365 331-460l57-47-24-133c-38-208-33-488 11-598 5-13-28-19-216-39-123-14-262-26-309-29l-86-4 11-61 12-62 39 3c22 1 112 14 200 27s210 27 270 31l110 6 28-89c15-48 27-93 27-100 0-14 0-14-160-52-247-58-508-174-732-323-64-43-120-83-123-88s8-32 25-59l31-51 27 17c15 9 77 49 137 88 134 87 247 148 383 209 114 50 292 110 362 121 25 4 53 11 62 16 15 8 23-1 49-53 17-35 52-91 76-126 25-35 43-65 41-66-1-1-30-13-63-26-264-103-520-273-728-483-127-129-297-349-297-385 0-10 74-62 87-62 5 0 48 57 97 126 104 147 246 300 360 389 153 119 402 262 539 311 43 15 80 31 83 35 10 16 22 9 43-23 11-18 29-43 40-55l20-22-46-22c-119-57-318-232-459-400-87-105-224-311-224-337 0-7 18-21 41-32 50-26 48-27 131 93 176 259 330 421 490 516l36 22 13-38c8-23 14-85 14-157v-120l-35-9c-82-21-110-68-131-223-20-140 19-392 94-604 22-63 46-135 52-160l13-45 11 42c14 52 72 137 125 184l41 36-27 79c-41 124-51 191-46 321 6 132 26 203 82 276 46 62 94 82 191 82 95-1 168-21 248-69l58-35 45 29c262 165 627 138 852-65 41-37 53-43 58-31 10 25 111 96 188 132 40 18 112 41 161 50 82 17 95 17 182 2 115-20 180-51 261-124l63-56-25 64c-57 153-133 267-240 360-95 83-96 84-76 73 145-83 365-251 440-336 112-126 210-257 210-280 0-6 18 5 40 25s47 36 55 36c25 0 18 16-47 97-129 161-321 335-523 473-60 41-131 91-157 109l-48 35 29 17c16 9 35 27 44 39l15 21 100-44c339-149 685-434 925-759 16-21 31-38 35-38s23 13 42 29l35 29-60 88c-81 120-344 383-496 496-153 114-233 165-356 227-57 28-103 53-103 56s23 37 51 76 53 78 56 86c7 17 12 15 108-25 206-86 396-199 565-335 52-42 97-77 100-77s6 18 7 40c2 22 7 50 13 60 14 27 12 29-79 98-143 108-350 226-588 335-46 21-83 40-83 43s9 17 20 32c10 15 38 77 60 138l41 110 109-13c60-7 155-22 212-33s108-20 114-20c7 0 15 21 19 46 3 26 9 52 11 59 5 11-23 16-372 67l-71 10 16 51c23 80 22 461-2 586-18 91-18 95 0 105 10 5 44 35 76 65 104 99 215 263 281 415l33 74 84-45c98-52 164-100 272-196 98-89 167-174 273-340 81-125 204-358 204-384 0-7 4-13 10-13 5 0 3 18-4 43-95 304-111 371-102 431 15 88 68 136 153 136 55 0 106-21 193-79 145-96 402-344 532-511 149-193 316-491 382-680 41-119 93-336 107-445 19-145 16-438-5-555-24-135-52-242-88-340-127-347-295-539-528-606-75-21-415-32-473-14-144 43-296 225-351 421-37 128-37 328-1 484 90 383 68 695-71 1047-31 79-65 167-75 197-11 30-20 56-22 57-1 1-1-97 1-219 4-264-8-439-48-722-44-304-80-588-80-623v-30l-51 13-50 14 6-32c24-113 111-275 212-400 81-98 146-153 233-195l76-37-38-28c-53-38-98-112-98-164 0-33 5-46 27-63 26-21 31-21 557-18 589 4 588 4 676 71 43 33 44 33 84 18 52-19 262-20 366-2 114 20 250 67 381 131 215 105 365 230 514 428 101 136 132 188 208 351 85 184 126 332 152 559 32 273 14 544-56 829-83 341-203 616-506 1162-237 427-305 583-323 742-26 227 52 400 217 481s347 26 414-124c19-43 24-70 24-143 0-89 0-91-59-213-52-108-60-133-64-198-6-93 14-150 76-216 81-86 201-107 316-55 94 43 203 160 261 281 69 143 87 224 87 386 1 155-14 225-80 377-90 210-282 396-489 472-143 53-317 76-448 60zm-6213-796c76-38 128-73 198-135 95-84 210-211 210-232 0-6-28-27-62-46-104-60-233-200-291-315-32-65-75-191-96-282l-16-73-75 88c-149 173-220 306-261 491-53 243 12 496 141 550 14 6 53 10 87 8 51-2 80-12 165-54zm2832 20c45-33 105-127 132-210 36-109 20-377-27-463-5-8-22-46-39-83-38-88-99-173-189-264-74-76-91-86-91-54 0 62-100 294-173 401-53 77-188 205-247 235-30 15-57 29-59 31-6 6 132 164 211 242 82 81 118 107 205 151 115 59 207 63 277 14zm-1364-618c171-26 315-81 442-166 69-47 120-91 267-228 125-116 155-137 219-147 42-6 43-7 83-92 99-207 123-315 109-494-8-101-39-260-53-274-5-6-469-61-556-66l-54-4-2-84h45c25 0 153 7 284 15 132 8 241 13 242 12 5-5-75-192-83-194-6-2-62 5-125 16-64 11-158 23-209 26-52 3-104 8-116 11-21 4-23 1-23-44v-49l133-17c72-10 163-23 200-29l69-13-53-71c-40-54-57-69-69-63-19 10-262 82-264 78-1-2-7-22-13-46-10-42-10-44 16-53 14-5 52-20 83-32l56-21-31-36-32-35-55 27c-45 22-126 58-257 115-9 3-13-6-13-29 0-38 13-51 113-107 31-18 55-36 52-40-11-19-153-106-229-141-141-65-263-95-391-94-97 0-121 4-204 32-123 43-286 124-349 175l-51 41 32 11c18 6 50 22 72 36 22 13 52 31 68 38 27 14 40 61 16 61-25 0-257-83-296-106-36-21-43-22-50-9-5 8-24 26-42 40-24 17-30 26-20 29 68 23 155 46 175 46h23l-20 47c-11 26-22 49-23 50-2 2-63-12-135-32-73-19-138-35-144-35-11 0-90 110-103 143-8 21 19 25 219 33l167 6v44 44h-227-228l-27 74c-30 77-33 90-20 82 4-2 106-12 227-20 121-9 235-19 253-22l33-5-6 86-115 17c-63 9-182 26-265 38-82 12-153 24-156 26-4 2-17 52-30 111-33 150-33 334 0 448 45 157 71 193 297 409 112 107 230 215 261 239 121 92 284 164 438 192 96 18 330 18 445 0z" />
              <path
                d="m3634 5472c-17-15-71-58-120-97-136-108-268-239-313-311l-41-66 52 7c29 4 131 27 226 51 96 24 187 45 204 46 30 2 30 3 24 48-13 111-18 277-8 313 6 20 10 37 9 37s-16-13-33-28z" />
              <path
                d="m1983 5452c-6-4-13-72-16-158-4-84-9-158-12-167-5-11 8-18 52-30 256-68 382-97 415-97h39l-33 46c-41 57-239 249-338 328-41 33-80 65-86 72-5 7-15 10-21 6z" />
              <path
                d="m2386 4822c-7-12 12-78 35-124 27-52 128-157 226-235 46-37 83-72 83-79 0-18-74-79-160-131-75-45-140-99-140-116 0-5 13-7 30-4 16 4 48 0 71-8 81-29 180-10 252 47l37 29 54-30c82-48 148-61 218-45 32 8 64 11 73 8 8-3 15-2 15 3 0 18-66 71-170 138-105 67-130 89-130 110 0 7 25 29 55 49 77 54 179 166 215 235 29 58 55 149 46 158-7 7-39-13-111-67-117-89-217-117-353-100-94 12-177 50-258 118-61 52-78 60-88 44z" />
              <path
                d="m0 3240v-450h128c70 0 265-3 433-7l306-6 12-33c37-103 223-113 274-14 21 41 17 118-8 157-57 87-217 84-254-6-8-17-18-28-24-24-5 3-179 7-386 8s-381 3-387 3c-7 2-9 110-6 353l4 351 221-1 222-2-3 60-4 61h-264-264v-450z" />
              <path
                d="m90 2447c-13-7-35-28-48-47-32-47-28-139 7-187 41-55 136-79 191-48 20 11 82 14 313 15h287v-540-540h-200-200v28c-1 68-63 122-142 122-92 0-158-58-158-138 0-93 62-162 147-162 47 0 120 31 130 55 3 9 13 13 27 10 22-6 419-13 809-14l227-1v-201-202l-46 7c-26 3-264 6-530 6h-482l-7 31c-9 42-59 95-101 109-76 26-163-17-185-90-28-91 46-200 135-200 53 0 88 12 116 40 20 20 27 21 598 20 335 0 583 4 591 9 11 7 23 2 44-15 22-18 40-24 78-24 102 0 169 66 169 166 0 92-58 144-161 144-37 0-76-6-93-15-15-8-30-15-31-15-2 0-4 52-4 115l-1 115h707 708l-6-640-117 1c-64 1-154 4-200 7-82 7-82 7-100 42-36 72-122 100-198 64-71-34-96-132-54-215 39-75 124-100 204-60 36 19 54 20 295 14l258-6 6 69c4 38 7 216 7 397v327l588-2 587-3v55 55h-1343-1343v440c1 300-3 435-9 423-6-10-26-20-45-24l-35-6v-413-412l-112-6c-62-4-189-7-283-7h-170l-3 208c-1 114 1 357 4 540l6 333 647-6 28 100-648 3-648 2 2 49c2 40-3 54-23 76-47 51-134 70-190 42z" />
              <path
                d="m8415 1600c-48-20-95-92-95-146v-26l-1345 8-1345 7-2-79c-1-44 0-188 2-321l3-243h-859l-17 29c-41 70-160 81-223 20-19-18-34-38-34-43 0-11-157-11-683-3l-167 2v-404c0-363 2-403 16-397 9 3 27 6 40 6h24v703l68-6c37-4 209-7 382-7h315l25-37c34-49 76-73 130-73 63 0 129 47 130 92 0 17 28 18 425 18h424l3-178c2-126-1-185-9-204-24-50-16-97 21-134 28-28 42-34 76-34 76 0 119 39 120 107 0 60-39 103-100 110l-45 5 6 328h597l22-35c38-61 75-85 133-85 74 1 117 40 117 109 0 50-44 90-107 98l-53 6v107c0 59 3 182 7 274l6 167 976-1c827-1 979-4 995-16 27-19 110-18 152 2 67 32 96 143 54 211-34 57-126 88-185 63zm-2115-297c0-21 1-145 2-277l3-239-80 7c-44 3-180 6-303 6h-222c-9.8042 178.58-1.9057 369.26 2.5628 543.32 243.62-4.9173 370.42-3.3238 597.44-3.3238z" />
              <path
                d="m6693 1161c-51-23-73-63-73-128 0-141 158-203 261-102l24 24 513-5c476-5 514-6 523-23 27-47 122-61 188-27 75 38 103 152 54 219-41 55-132 77-193 46-34-18-65-59-74-100l-6-30h-493-493l-20 50c-16 41-27 54-64 73-54 27-92 28-147 3z" />
              <path
                d="m2207.3 1226.9c-45.826 9.4091-84.746 40.673-105.06 84.394-14.67 31.571-15.233 84.543-1.2702 119.68 11.997 30.193 46.805 68.176 75.213 82.074 29.005 14.191 63.556 17.314 248.28 22.44 84.906 2.3564 160.76 5.6679 168.57 7.3589 23.045 4.9915 20.132 13.703-16.944 50.673-38.779 38.667-73.713 66.047-89.186 69.899-6.767 1.6847-26.882-1.8789-54.844-9.7163-52.787-14.796-92.113-22.1-176.19-32.723-180.04-22.749-331.73-28.622-385.3-14.919-50.459 12.906-83.867 47.126-102.53 105.02-7.7626 24.085-9.2607 36.249-8.1378 66.081 3.674 97.605 4.1422 93.714-16.618 138.12-21.736 46.499-27.674 65.915-27.706 90.592-0.03 21.188 6.7032 34.864 26.393 53.626 20.039 19.096 28.096 35.922 40.354 84.278 36.583 144.32 106.61 270.8 207.12 374.11 60.672 62.361 119.14 97.984 211.58 128.91 59.952 20.059 105.5 26.363 209.58 29.002l91.764 2.3273 25.433 51.23c32.323 65.11 63.644 112.4 90.324 136.39 50.917 45.779 160.53 78.431 232.94 69.385 20.34-2.5413 26.056-5.3797 43.284-21.494 25.119-23.496 45.628-64.946 54.53-110.21 9.5007-48.309 6.2408-148.59-6.2176-191.27-12.785-43.795-30.152-76.069-60.06-111.61-14.468-17.195-25.662-31.868-24.874-32.607 0.7873-0.7395 14.467-3.3468 30.4-5.7942 40.105-6.1607 95.423 1.0092 147.95 19.176 63.323 21.902 90.07 43.813 276.05 226.14 143.51 140.69 197.47 188.05 264.06 231.78 98.283 64.54 220.76 112.21 345.31 134.4 54.673 9.7402 217.28 9.6429 290.47-0.174 360.79-48.39 646.15-253.67 836.01-601.39 58.226-106.64 98.943-208.09 144.47-359.95 33.627-112.17 52.806-164.22 69.392-188.32 42.36-61.569 127.85-104.01 209.5-104.01 65.549 0 114.04 18.974 267.96 104.84l85.147 47.502 87.509 2.6771c48.13 1.4725 545.45 3.8245 1105.2 5.2268 559.71 1.4024 1063.4 4.3312 1119.2 6.5087 170.25 6.6363 205.73 15.376 248.27 61.142 86.63 93.207 91.381 97.102 118.45 97.102 20.971 0 54.147-10.164 67.526-20.688 14.203-11.172 26.852-36.454 26.852-53.671 0-47.797-51.317-125.37-118.49-179.12-38.143-30.518-110.6-68.584-147.6-77.54-84.638-20.49-189.4-22.226-1347.2-22.329l-1038.5-0.092-44.172-24.912c-76.215-42.983-253.56-131.51-298.08-148.79-54.194-21.038-78.524-25.362-142.73-25.362-78.899 0-122.72 9.7593-244.35 54.418l-39.735 14.59-16.103-33.729c-28.023-58.697-98.454-151.36-154.46-203.21-74.566-69.037-149.69-102.87-325.26-146.47-80.383-19.962-252.75-55.292-269.76-55.292-22.947 0-67.493 26.024-77.427 45.234-3.2165 6.2202-5.811 22.544-5.811 36.563 0 48.624 20.402 72.288 82.222 95.37 17.292 6.4565 31.46 13.296 31.484 15.198 0.126 9.8816-99.198-8.0856-145.19-26.264-29.685-11.733-68.243-20.077-165.98-35.917-101.18-16.397-217.53-45.099-289.15-71.33-77.999-28.565-110.15-27.834-145.53 3.3098-34.788 30.622-43.106 68.485-23.63 107.57 18.13 36.381 42.058 51.118 125.62 77.367 29.047 9.124 56.469 19.416 60.938 22.87 7.8669 6.0817 7.8867 6.4657 0.624 12.094-4.1255 3.1968-19.665 7.31-34.531 9.1406-43.607 5.3694-248.4 3.6825-325.62-2.6823-62.161-5.123-108.88-5.6661-239.95-2.7889l-30.73 0.6742-41.256-31.233c-90.986-68.882-178.68-106.8-316.81-136.98-102.46-22.389-144.88-23.772-429.54-13.997l-73.125 2.5109-7.029-24.466c-5.7748-20.101-10.702-27.768-27.618-42.978-32.767-29.461-83.609-43.621-125.64-34.991zm37.458 929.15c26.219 26.287 47.671 49.716 47.671 52.064 0 7.1598-75.604 78.89-83.15 78.89-3.8816 0-29.837-22.403-57.68-49.785l-50.622-49.785 45.513-39.59c25.032-21.774 46.657-39.59 48.056-39.59 1.3984 0 23.994 21.508 50.213 47.795z"
                fill="#800080" />
            </g>
          </svg>
        </div>
        <div class="mg-col mg-x5">
		<h1><span class="purple">R</span>at<span class="purple">C</span>hat<span class="purple">PT</span></h1>
          <form>
            <fieldset>
            <div class="mg-select">
              <select id="agentId" onchange="loadResults()"></select>
            </div>
	    </fieldset>
          </form>
        </div>
        <div class="mg-col mg-x4">
          <h5>A story of a Rat, a Chat and an APT</h5>
	  <div>
	    <label class="mg-toggle mg-label--light float-right">
              Auto Refresh
              <input type="checkbox">
              <span class="checkmark"></span>
            </label>
	  </div>
	  <div>
	  <div class="mg-loader" id="refresh">
	  <button class="button-primary float-right" type="submit" value="Send Order" onclick="loadResults()">Refresh
	  <span class="mg-icon mg-icon--loader mg-loader--status"></span></button>
	  </div>
          </div>
        </div>
      </div>
    </section>
    <section class="mg-container" id="alerts"></section>
    <section class="mg-container" id="examples">
      <form>
        <fieldset>
          <label for="Command">Command</label><textarea placeholder="whoami" id="command"></textarea>
	  <div class="mg-loader" id="button">
	  <button class="button-primary" type="submit" value="Send Order" onclick="sendCommand(event)">Send Order
	  <span class="mg-icon mg-icon--loader mg-loader--status"></span></button>
	  </div>
        </fieldset>
      </form>
      <div id="results">
      </div>
    </section>
  </main>

  <script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    function new_alert(text) {
      const newAlert = document.createElement("div");
      newAlert.classList.add('mg-alert', 'success');
      newAlert.innerHTML='<span class="mg-close mg-right" onclick="this.parentElement.style.display=\'none\';"></span><code>'+text+'</code>';
      const alerts = document.getElementById("alerts");
      alerts.appendChild(newAlert);
    }

    async function loadResults() {
      const button = document.getElementById("button");
      button.classList.add('mg-loader--loading');
      const refresh = document.getElementById("refresh");
      refresh.classList.add('mg-loader--loading');

      const response = await fetch("./data.json");
      const data = await response.json();
      select = document.getElementById("agentId");

      options = [...select].map(el => el.value);
      if (data["Agents"] != null) {
        for (var a of data["Agents"]) {
          if (!(options.includes(a["Id"]))) {
            var opt = document.createElement("option");
            opt.value = a["Id"];
            opt.innerHTML = a["Id"] + " (" + a["OnboardData"]["U"] + "@" + a["OnboardData"]["H"] + ")";
            select.appendChild(opt);
          }
        }

        //if(urlParams.has("agentId")){document.getElementById("agentId").value = urlParams.get('agentId')}
        div_results = document.getElementById("results");
        div_results.innerHTML = "";
        //Find the current selected Agent
        for (var a of data["Agents"]) {
          if (a["Id"] == document.getElementById("agentId").value) {
            for (var r of a["RPCAgentAll"]) {
              console.log(r["DateRequest"], r["DateReturn"], r["RPCRequest"], r["RPCReturn"]);
  	      var div_res = document.createElement("div");
	      var span_res = document.createElement("span");
	      span_res.innerHTML = r["DateRequest"].split('.')[0] + ' | <span class="purple">' + r["RPCRequest"]["F"] + '(' + r["RPCRequest"]["P"] + ')</span>';
              var pre_res = document.createElement("pre");
              var code_res = document.createElement("code");
              code_res.innerHTML = r["RPCReturn"]["SO"];
              div_results.prepend(div_res);
	      div_res.appendChild(span_res);
	      div_res.appendChild(pre_res);
              pre_res.appendChild(code_res);
            }
          }
        }
      }
      button.classList.remove('mg-loader--loading');
      refresh.classList.remove('mg-loader--loading');
    }

      async function sendCommand(e){
        e.preventDefault();
        const button = document.getElementById("button");
        button.classList.add('mg-loader--loading');

	command = document.getElementById("command").value;
	if (command ==""){new_alert("Empty Command!");button.classList.remove('mg-loader--loading');return;}

        var data = new FormData();
	agentId = document.getElementById("agentId").value;
        console.log("New command to send: "+command);
	data.append("agentId", agentId);
	data.append("command", command);
	fetch("/", {
  	method: "POST",
	headers: new Headers({'content-type': 'application/x-www-form-urlencoded'}),
	body: "agentId="+agentId+"&command="+command,
	})
	.then(response => response.text())
   	.then((response) => {
       	new_alert(response);
        button.classList.remove('mg-loader--loading');
	loadResults();
   	})
      }
      loadResults();
  </script>

</body>

</html>
